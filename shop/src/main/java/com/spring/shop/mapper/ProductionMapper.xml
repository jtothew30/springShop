<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.spring.shop.mapper.ProductionMapper">
	
	<!-- detail -->
	<select id="selectProductOne" parameterType="int">
		select * from production where pno = #{pno}
	</select>
	
	<!-- TODO -->
	<!-- 초기등록시 리셋을 위한 detail이 필요한데 pno값을 모름 -->
	<!-- pname, options 받아서 검색 return detail 필요 -->
	
	<!-- 제품리스트 출력 +count(prostock 테이블 참조) -->
	<select id="selectProductAll" resultType="com.spring.shop.vo.Production" >
		select p.*, (select count from prostock s where p.pno = s.pno) count 
		from production p
	</select>	
		
	<!-- 제품등록 -->
	<insert id="insertProduct" parameterType="com.spring.shop.vo.Production">	
		insert into production values(
			seqpro.nextval,
			#{pname},
			#{brand},
			#{inprice},
			#{outprice},
			#{category1},
			#{category2},
			#{category3},
			#{options},
			#{script},
			#{sales}
		)			
	</insert>
	
	<!-- 제품등록시 재고목록 등록 및 초기화 (오류수정중)-->
	<insert id="resetProductCount" parameterType="com.spring.shop.vo.Production">
		insert into prostock values(#{pno},0)
	</insert>
	
	<!-- 재고 update -->
	<update id="updateProductCount" parameterType="com.spring.shop.vo.Production">
		update prostock set count=#{count} where #{pno} = pno
	</update>
	
</mapper>